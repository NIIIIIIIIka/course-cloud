spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

  cloud:
    nacos:
      discovery:
        server-addr: nacos:8848
        namespace: dev
        group: COURSEHUB_GROUP
        ephemeral: true
        heart-beat-interval: 5000
        heart-beat-timeout: 15000
        enabled: ${SPRING_CLOUD_NACOS_DISCOVERY_ENABLED:true}
        metadata:
          version: ${SERVICE_VERSION:1.0.0}
          zone: ${SERVICE_ZONE:zone-A}
          weight: ${SERVICE_WEIGHT:100}
          env: ${SERVICE_ENV:dev}
          region: ${SERVICE_REGION:east}
      config:
        enabled: ${SPRING_CLOUD_NACOS_CONFIG_ENABLED:false}

server:
  port: ${SERVER_PORT:8083}
# Feign 配置
feign:
  circuitbreaker:
    enabled: true # 启用熔断器
  client:
    config:
      default:
        connectTimeout: 3000 # 连接超时 3 秒
        readTimeout: 5000 # 读取超时 5 秒

# Resilience4j 熔断器配置
resilience4j:
  circuitbreaker:
    instances:
      user-service: # 针对 user-service 的熔断器配置
        failureRateThreshold: 50 # 失败率阈值 50%
        slidingWindowSize: 10 # 滑动窗口 10 次请求
        slidingWindowType: COUNT_BASED # 基于请求数的滑动窗口
      catalog-service: # 针对 catalog-service 的熔断器配置
        failureRateThreshold: 50
        slidingWindowSize: 10
        slidingWindowType: COUNT_BASED
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

# 外部服务配置（本地开发使用，生产环境使用Nacos服务发现）
services:
  user:
    url: ${SERVICES_USER_URL:http://user-service:8081}
  catalog:
    url: ${SERVICES_CATALOG_URL:http://catalog-service:8082}

